---
date: 2026-02-05
tags: [database, meetup, OceanBase, SeekDB]
status: active
---

---
date: 2026-02-05
tags: [database, Meetup, OceanBase, SeekDB]
status: active
---

# OceanBase & SeekDB Meetup ハンズオン学習メモ

> [!NOTE]
> 2026-02-05 OceanBase Meetupイベントでの学び

## イベント概要

- **イベント名**: OceanBase Meetup - AI-Native Database ハンズオン
- **日時**: 2026年2月5日
- **ハンズオン内容**: SeekDBを使った画像検索アプリケーション構築

---

## OceanBaseとは

### 基本情報
- **開発元**: Alibaba/Ant Group
- **種類**: 分散型リレーショナルデータベース
- **特徴**: MySQL互換、高可用性、水平スケーリング

### アーキテクチャ
- **Paxosベース**の分散合意アルゴリズム
- **マルチテナント**対応
- **ゾーン分散**による障害耐性
- RPO=0（データロスなし）、RTO数秒の高可用性

### ユースケース
- 金融系システム（Alipay等で実績）
- 大規模ECサイト
- ミッションクリティカルなアプリケーション

---

## SeekDBとは

### 概要
- OceanBaseの**AI-Native検索データベース**
- ベクトル検索、全文検索、構造化データ検索を**単一のSQLクエリ**で実行可能

### コア機能: Multi-type Data Search

```
┌─────────────────────────────────────────────────┐
│              SeekDB Multi-type Search           │
├─────────────────────────────────────────────────┤
│  ベクトル検索  │  全文検索  │  スカラー検索      │
│  (Vector)     │  (Text)   │  (Scalar/JSON/GIS) │
└───────────────┴───────────┴────────────────────┘
                    ↓
            単一SQLで統合クエリ
```

### AI組み込み関数

| 関数名 | 説明 | 用途 |
|--------|------|------|
| `AI_EMBED()` | テキスト/画像をベクトル化 | 埋め込み生成 |
| `AI_COMPLETE()` | LLMによるテキスト生成 | RAG、要約 |
| `AI_RERANK()` | 検索結果の再ランキング | 精度向上 |
| `AI_PROMPT()` | プロンプトテンプレート管理 | プロンプト管理 |

---

## ハンズオン: 画像検索アプリケーション

### システム構成

```
┌──────────────────────────────────────────────────────┐
│                   Streamlit UI                       │
│                 (localhost:8501)                     │
└──────────────────────┬───────────────────────────────┘
                       │
┌──────────────────────▼───────────────────────────────┐
│                Python Backend                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │   Towhee    │  │   OpenAI    │  │  pyobvector │  │
│  │ (Embedding) │  │ (Caption)   │  │  (DB接続)   │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
└──────────────────────┬───────────────────────────────┘
                       │
┌──────────────────────▼───────────────────────────────┐
│                    SeekDB                            │
│         (Docker Container: seekdb)                   │
└──────────────────────────────────────────────────────┘
```

### セットアップ手順

```bash
# 1. SSH接続
ssh oceanbase
# Password: oceanbaseV5

# 2. ワークスペース移動
cd workspace/image-search

# 3. 初期化（Python環境、依存関係、DB起動）
make init

# 4. アプリ起動
make start

# 5. ブラウザでアクセス
# http://<サーバーIP>:8501
```

### 使用技術スタック

| カテゴリ | 技術 | バージョン |
|----------|------|-----------|
| 言語 | Python | 3.12 |
| 仮想環境 | uv | - |
| フロントエンド | Streamlit | 1.53.1 |
| 埋め込み | Towhee (CLIP) | 1.1.3 |
| DB接続 | pyobvector | 0.2.22 |
| 機械学習 | PyTorch | 2.10.0 |
| 画像処理 | OpenCV | 4.13.0 |
| LLM | OpenAI API | 1.109.1 |

---

## 検索フローの詳細

### 1. 画像アップロード時の処理

```
ユーザー画像 → キャプション生成 → ベクトル生成 → 検索実行
              (AI_COMPLETE相当)  (CLIP/Towhee)  (ANN + Text)
```

### 2. ハイブリッド検索の仕組み

```python
# 実際のログから確認できた検索フロー

# Step 1: 画像からキャプション生成
# "Generated caption for temp.jpg: cat"

# Step 2: ベクトル検索 (ANN Search)
# "ANN search returned 50 results"
# "Filtered vector results by threshold 0.60: 7 remaining"

# Step 3: テキスト検索
# "Performing text search with query: cat"

# Step 4: ハイブリッド融合
# "Hybrid search: 7 vector + 22 text results before fusion"
# "Fused 10 results from vector and text search"
```

### 3. 検索モードの比較

| モード | 説明 | 結果数(例) |
|--------|------|-----------|
| Vector Only | 画像の視覚的類似度のみ | 7件 |
| Text Only | キャプションによるテキスト検索 | 22件 |
| Hybrid | 両方を融合（RRF等） | 10件 |

### 4. 類似度閾値（Threshold）

- 設定値: **0.60**
- 目的: 低品質な結果をフィルタリング
- 動作: ANN検索で50件取得 → 閾値でフィルタ → 7件に絞り込み

---

## 重要な学び

### ベクトル検索のポイント

1. **埋め込みモデルの選択が重要**
   - 今回はCLIP（画像とテキストの共通埋め込み空間）
   - 用途に応じてモデルを選択（文章ならSentence-BERT等）

2. **ANN（近似最近傍）検索**
   - 完全一致ではなく近似で高速化
   - HNSW、IVF等のインデックスアルゴリズム

3. **閾値設定のトレードオフ**
   - 高い閾値 → 精度↑、再現率↓
   - 低い閾値 → 精度↓、再現率↑

### ハイブリッド検索のメリット

```
┌────────────────┐     ┌────────────────┐
│  Vector Search │     │   Text Search  │
│  (意味的類似)  │     │ (キーワード)   │
└───────┬────────┘     └───────┬────────┘
        │                      │
        └──────────┬───────────┘
                   ▼
          ┌───────────────┐
          │  RRF Fusion   │
          │ (ランク融合)   │
          └───────────────┘
                   │
                   ▼
            最終結果
```

- **意味的検索**と**キーワード検索**の両方の強みを活用
- 片方で見つからない結果をカバー
- RRF（Reciprocal Rank Fusion）で公平にランク統合

### SeekDBの強み

1. **単一DB**でベクトル+全文+構造化データを管理
2. **SQLベース**で学習コストが低い
3. **AI関数**がビルトインで統合が容易
4. **OceanBase基盤**で高可用性・スケーラビリティ

---

## 企業導入時の考慮事項

### セキュリティ面

| 観点 | 評価 | 詳細 |
|------|------|------|
| データ暗号化 | ○ | TLS/SSL、保存時暗号化対応 |
| 認証・認可 | ○ | RBAC、細粒度アクセス制御 |
| 監査ログ | ○ | 操作履歴の記録 |
| コンプライアンス | △ | 国内事例はまだ少ない |

### 運用面

| 観点 | 評価 | 詳細 |
|------|------|------|
| 日本語ドキュメント | △ | 英語・中国語が主 |
| サポート体制 | △ | 国内パートナーは限定的 |
| コミュニティ | ○ | 活発、GitHub上で開発進行中 |
| クラウド対応 | ○ | Alibaba Cloud、AWS等 |

### 推奨アプローチ

1. **PoC（概念実証）から始める**
   - 小規模なユースケースで検証
   - パフォーマンス、運用性を評価

2. **既存MySQLからの移行パス**
   - MySQL互換なので段階的移行可能
   - ダンプ→リストアで基本的なデータ移行

3. **ハイブリッド構成の検討**
   - ミッションクリティカル部分は既存DBを維持
   - AI検索機能部分にSeekDBを採用

---

## DB構成 比較表

### OceanBase vs GCP vs GCP+ベクトル検索

| 観点 | OceanBase (自前) | GCP Cloud SQL + BQ | GCP + Vertex AI Vector Search | GCP AlloyDB + pgvector | GCP Cloud SQL + pgvector |
|------|------------------|-------------------|------------------------------|----------------------|-------------------------|
| **初期費用** | 無料 | 無料枠あり | 無料枠あり | 無料枠あり | 無料枠あり |
| **月額費用** | $200〜300 | $300〜500 | $500〜1000+ | $400〜800 | $300〜500 |
| **セットアップ難易度** | ★★★★★ | ★★☆☆☆ | ★★★☆☆ | ★★★☆☆ | ★★☆☆☆ |
| **運用負荷** | ★★★★★ | ★★☆☆☆ | ★★☆☆☆ | ★★☆☆☆ | ★★☆☆☆ |
| **ベクトル検索** | ◎ 標準搭載 | × なし | ◎ 専用サービス | ◎ pgvector | ○ pgvector |
| **ハイブリッド検索** | ◎ 標準 | × | △ 別実装必要 | △ 別実装必要 | △ 別実装必要 |
| **AI関数組み込み** | ◎ | × | ○ Vertex AI連携 | △ 要実装 | △ 要実装 |
| **検索性能（大規模）** | ◎ | - | ◎ | ○ | △ |
| **RDB機能** | ◎ | ◎ | × (検索専用) | ◎ | ◎ |
| **スケーラビリティ** | ○ 手動 | ◎ 自動 | ◎ 自動 | ◎ 自動 | ○ |
| **高可用性** | ○ 自分で構築 | ◎ 標準 | ◎ 標準 | ◎ 標準 | ◎ 標準 |
| **日本語サポート** | × | ○ | ○ | ○ | ○ |
| **国内事例** | 少ない | 多い | 増加中 | 増加中 | 多い |
| **データ主権** | ◎ 完全管理 | ○ | ○ | ○ | ○ |

### ベクトル検索 詳細比較

| 観点 | SeekDB (OceanBase) | Vertex AI Vector Search | AlloyDB + pgvector | Cloud SQL + pgvector |
|------|-------------------|------------------------|-------------------|---------------------|
| **最大ベクトル数** | 数十億+ | 数十億+ | 数百万 | 数十万 |
| **次元数上限** | 2048+ | 2048 | 2000 | 2000 |
| **インデックス** | HNSW, IVF | ScaNN | HNSW, IVFFlat | HNSW, IVFFlat |
| **クエリ速度** | ◎ | ◎ | ○ | △ |
| **フィルタリング** | ◎ SQL統合 | ○ メタデータ | ○ SQL | ○ SQL |
| **更新頻度** | ◎ リアルタイム | △ バッチ推奨 | ◎ リアルタイム | ◎ リアルタイム |
| **SQL統合** | ◎ ネイティブ | × API別 | ◎ PostgreSQL | ◎ PostgreSQL |
| **料金体系** | インフラ費のみ | クエリ+保存量課金 | インスタンス課金 | インスタンス課金 |

### 構成パターン別コスト

| 構成 | 月額目安 | 向いてるケース |
|------|---------|---------------|
| **OceanBase/SeekDB (自前)** | $200〜300 + 運用工数 | AI検索ガチ勢、データ主権重視 |
| **Cloud SQL + pgvector** | $300〜500 | 小〜中規模、シンプル構成 |
| **AlloyDB + pgvector** | $400〜800 | 中〜大規模、PostgreSQL好き |
| **Cloud SQL + Vertex AI** | $500〜1000+ | 大規模、Google AI活用 |
| **Cloud SQL + Pinecone** | $400〜800+ | 専用ベクトルDB使いたい |

### アーキテクチャ比較

#### パターン1: OceanBase/SeekDB（オールインワン）
```
┌─────────────────────────────┐
│         SeekDB              │
│  ┌─────┬─────┬─────┐       │
│  │ RDB │Vector│ Text │       │
│  └─────┴─────┴─────┘       │
│     単一DBで完結！           │
└─────────────────────────────┘
```

#### パターン2: GCP分離構成
```
┌──────────┐  ┌──────────────┐  ┌─────────┐
│Cloud SQL │  │Vertex AI     │  │BigQuery │
│(トランザクション)│  │Vector Search │  │(分析)   │
└────┬─────┘  └──────┬───────┘  └────┬────┘
     └────────┬──────┴────────┬──────┘
              │   アプリ側で統合  │
              └────────────────┘
```

#### パターン3: AlloyDB統合
```
┌─────────────────────────────┐
│        AlloyDB              │
│  ┌─────────┬───────────┐   │
│  │PostgreSQL│ pgvector  │   │
│  │  (RDB)   │(ベクトル)  │   │
│  └─────────┴───────────┘   │
└─────────────────────────────┘
         ↓ 分析時
┌─────────────────────────────┐
│        BigQuery             │
└─────────────────────────────┘
```

### ユースケース別おすすめ

| 要件 | ベストな選択肢 |
|------|--------------|
| **ベクトル検索 小規模（〜10万件）** | Cloud SQL + pgvector |
| **ベクトル検索 中規模（〜100万件）** | AlloyDB + pgvector |
| **ベクトル検索 大規模（100万件〜）** | Vertex AI Vector Search or SeekDB |
| **ハイブリッド検索必須** | **SeekDB** ← これが強み！ |
| **RDB + ベクトル統合** | AlloyDB or SeekDB |
| **運用楽したい** | GCPマネージド系 |
| **コスト最小化** | Cloud SQL + pgvector |
| **将来の拡張性重視** | Vertex AI or SeekDB |

### Claude Code活用時の運用負荷

| 構成 | 運用負荷 |
|------|---------|
| OceanBase自前 のみ | ★★★★★ 大変 |
| OceanBase自前 + Claude Code | ★★★☆☆ まあまあ |
| マネージド のみ | ★★☆☆☆ 楽 |
| マネージド + Claude Code | ★☆☆☆☆ 超楽 |

> [!TIP]
> Claude Codeは**作業効率を上げるツール**であり、**運用を代行するツールではない**。
> 24/365監視や自動復旧は別途ツールが必要。

---

## 次のステップ

- [ ] SeekDB公式ドキュメントを読む
- [ ] ローカル環境でDocker版を試す
- [ ] 自社データでPoCを検討
- [ ] RAG（検索拡張生成）との組み合わせを調査

---

## イベント詳細メモ（発表内容）

### AIネイティブデータベースの思想

> [!IMPORTANT]
> **「データ特性で差別化しているAIアプリケーションが最終的に生き残る」**
> - すぐに死んでしまうAIエージェント・アプリが多い中、データを中心としたアプリが価値を持つ
> - 2026年後半にはデータ型AIアプリケーションが盛んになると予測

### CFDB（SeekDB）の4つの特徴

| 特徴 | 詳細 |
|------|------|
| **1. 軽量性** | 1コア、2GBメモリで動作可能。ノートPC・スマホにも搭載可能 |
| **2. オープンソース** | 全てApache 2.0、ライセンス費用なし |
| **3. マルチモーダル対応** | テキスト、画像、ビデオ、JSON、GISデータ等 |
| **4. 統合環境** | 従来は複数DBが必要だったものを1つで処理 |

### LLM活用による新しい検索

従来のDBにないデータも検索可能に：
- 「静かな喫茶店」
- 「人が少ない喫茶店」
- 「500m以内で評価4.5以上」

→ **SQLの1文で全条件を検索可能**

### Model-in-Database技術

```
従来: アプリ → DB → アプリ → LLM → アプリ → DB（往復が長い）
    ↓
今: アプリ → DB（内部でLLM処理）→ アプリ（短縮化）
```

- DB層でエンベディング計算を実行
- 開発者の実装を大幅に簡略化
- チューニング・性能最適化も容易に

### 画像検索の技術詳細

#### ベクトルストレージ

```
画像 → RGB変換 → CLIPモデル → 512次元ベクトル → L2正規化 → DB保存
                                    ↓
                              キャプション生成（VLM API）
```

#### ベクトル検索

| 項目 | 詳細 |
|------|------|
| **インデックス** | HNSW（Hierarchical Navigable Small World） |
| **距離計算** | L2距離 |
| **次元数** | 512次元 |
| **正規化** | L2正規化（ベクトル長を1に統一） |

#### ハイブリッド検索パラメータ

| パラメータ | 説明 | デフォルト値 |
|-----------|------|-------------|
| **リコール数** | 検索結果の表示件数 | - |
| **ベクトル重み** | ベクトル検索と全文検索の比率 | 0.7 |
| **距離閾値** | ベクトル検索結果の絞り込み | 0.6 |

> [!TIP]
> - 距離閾値を**下げる** → 緩い検索（似てないものも含む）
> - 距離閾値を**上げる** → 厳しい検索（類似度高いもののみ）

### 実装コードのポイント

#### テーブル定義
```sql
-- ネイティブなベクトル型（512次元をそのまま保存）
CREATE TABLE image_search (
    id INT,
    image_vector VECTOR(512),  -- ベクトル型
    caption TEXT
);

-- HNSWベクトルインデックス
CREATE INDEX vec_idx ON image_search USING HNSW(image_vector);

-- 全文検索インデックス
CREATE FULLTEXT INDEX caption_idx ON image_search(caption);
```

#### PyOBVectorライブラリ
- ANN検索をシンプルなPythonコードで呼び出し可能
- 複雑なベクトル演算を意識する必要なし

### デモ環境情報

| 環境 | 詳細 |
|------|------|
| **本番相当環境** | AWS東京リージョン、3レプリカ構成 |
| **Dify環境** | OceanBaseをリレーショナルDBとして使用 |
| **PowerMemory** | LLM通信時のトークン使用量を削減するコンポーネント |

### 面白かった実験結果

- 犬のイラスト → 距離閾値を下げると実写の犬もヒット
- 猫の画像 → 似た猫が複数ヒット
- **顔画像検索** → インフルエンサーの類似人物検索に使えそう！

### MySQL互換性

- SQLの書き方はMySQLと互換
- `SELECT`, `INSERT`, `ORDER BY`, `LIMIT` など標準SQL対応
- 既存のMySQL知識がそのまま使える

---

## 参考リンク

- [OceanBase公式](https://www.oceanbase.com/)
- [SeekDB GitHub](https://github.com/oceanbase/oceanbase)
- [Towhee（埋め込みパイプライン）](https://towhee.io/)
- [CLIP（OpenAI）](https://openai.com/research/clip)

---

#guchi #oceanbase #seekdb #ai #database #vector-search #meetup
