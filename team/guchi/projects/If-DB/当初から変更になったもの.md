・インフルエンサーマスタの重複削除は手動


会議録音
### プロジェクト概要

- 管理部向けのインフルエンサーマスターとCVデータを管理するアプリ化プロジェクト
- 現状のスプレッドシート管理における重複やデータの問題を解決することが目的
- 最小ゴールとして、インフルエンサーマスター、ANSEMから取得するCVデータ、単価入力機能、計算結果の出力を実装予定
- 段階的にIFチーム向けの機能を拡張していく方針

### 現状の課題

- パートナーサイト名に様々な情報(BU、担当者、予算区分など)が埋め込まれており、データ構造が複雑
- ANSEMから出力されたデータを「調理」(加工)する工程が必要で、名前の規則に依存している
- CV返りなど、文字列のブレによる問題が発生している
- 複数のスプレッドシートにデータが散在し、管理が煩雑
- ANSEMのデータ加工に時間がかかりすぎている

### 技術要件と解決方向性

- パートナーサイトIDによる管理に移行し、名前への情報埋め込みを廃止
- カスタム項目として必要な情報(担当者、案件区分など)を保持する仕様
- パートナーサイト番号は重複しないため、ID管理が可能
- 現状の運用(名前ベースの処理)は並行稼働させながら、システム側でID管理を実装
- アプリ化により、複雑なスプレッドシートの「調理」工程をスキップ可能

### 計測・請求の粒度に関する議論

- 計測軸と請求軸の2軸が存在することを確認
- 計測はパートナーサイト単位でCVが追えれば問題ない
- エージェントはBUに関わらず件数を見るが、金額計算時はBUを除外する処理が必要
- クライアント請求とインフルエンサー支払いの両方をスコープに含める方針

### データ構造とルールの洗い出しが必要な項目

- 計測に関わる最小粒度とルール(ノアさん担当)
- 請求単価・支払い単価のルール(チャンさん担当)
- パートナーサイト名の命名規則と埋め込み情報の定義
- 案件種別、予算区分、BU情報などの属性管理
- 期日ベース、件数ベース、固定、予算、ボーナスなどの単価設定パターン

### CSVエクスポートに関する問題

- パートナーIDとパートナー名の2カラムが存在
- CSV出力時にコロン区切りで番号が付いて出力される
- 3桁の数字が重複すると一部データが欠損する問題

### スコープと段階的実装

- 第一段階:管理部向けのデータ基盤構築に集中
- テスト期間を1ヶ月設けて、データの整合性を確認
- インフルエンサー単価は今回のスコープ外(後のフェーズで検討)
- おまとめ購入と単品購入の区別などクライアント固有の要件は保留

### 求める機能

- 担当者単位での検索・絞り込み機能
- エージェント単位での集計機能
- スプレッドシートのフィルター機能に近い、項目別の絞り込み
- シンプルで直感的な操作性(「猿でもできる」レベルの簡単さ)

### データフローの整理が必要な範囲

- IFアンセムガス → 月別詳細 → 各種スプレッドシートの流れを確認済み
- 戦略企画など他部署で使用しているスプレッドシートの洗い出しが必要
- 現在は王道ルート以外のデータ参照は存在しないことを確認

### アクションアイテム

- [ ] ノアさん:計測の粒度に関するルールを文書化して共有
- [ ] チャンさん:請求単価・支払い単価に関するルールを文書化して共有
- [ ] プランナー(アイカワ、ノサキさん)にヒアリングを実施して要件を確認
- [ ] 来週、1時間のガッツリした要件整理会議を開催
- [ ] 全体像を文書化してチーム内で共有(口頭より文章での共有を優先)
- [ ] 現状の「隠れルール」を全て洗い出す

### 現状の課題

- インフルエンサーのマスターデータに重複レコードが大量に存在している
- 同一人物が複数のレコードとして登録されている理由:
    - 請求先が変わる場合（個人と事務所など）
    - SNSアカウントが異なる場合（InstagramとYouTubeで別レコード）
    - 所属が変わる場合
- 現在は目視で重複を判断しており、明確なルールがない
- マスター名が重複しているケースも存在し、本来ユニークであるべきデータが整理されていない

### データ構造の設計方針

- 上位概念のマスターテーブルを作成し、請求先やSNS情報を外部キーで管理する階層構造が必要
- ユースケース（業務フロー）とデータベース設計を分離して考える必要がある
    - 現場はユースケースベースで話している
    - エンジニアはデータの正規化を考える必要がある
- 請求先、口座情報、SNS情報などは1対Nの関係として別テーブルで管理

### 重複検知の現状分析

- 全てのSNS情報が一致しているケース: 100件程度
- マスター名が完全一致: 2件のみ
- Instagram URL重複: 23件
- YouTube URL重複: 11件（グループYouTuberを含む）
- 口座情報重複: 多数（事務所所属者など）
- グループYouTuberの場合、YouTubeは同じだがInstagramが個別というケースがあり、システムでの一意化が困難

### 決定事項と方針

- データの一意性を保証するルールを策定する
    - 個人の場合: 名前と生年月日の組み合わせでユニークにする
    - グループの場合: グループ名と主要SNS（YouTube等）でユニークにする
- マスター名による部分一致検索でリストアップし、管理部門に確認してもらう
- 新規データは正規化されたルールで入力し、既存データは段階的にクレンジングする
- 重複データは登録時に検知し、入力者に確認してもらう仕組みを作る
- フリーIDが既に振られているため、既存データの構造は維持する必要がある

### 技術的な課題

- マスター名の部分一致だけでは重複を完全に検知できない
- SNS情報のみでの一意化は不可能（グループYouTuberの存在）
- 現状のデータが「気持ち悪い」状態で放置されると、それが標準になってしまう
- データベース的に正規化しても、ユースケース的な表現が必要

### アクションアイテム

- [ ] SNS情報（Instagram、YouTube、TikTok等）の重複リストを作成して管理部門に提供する
- [ ] マスター名の部分一致リストを作成（ただし完全な検知は困難）
- [ ] データ入力時のユニークチェックルールを実装する
- [ ] 業務プロセスとして、必須入力項目を定義する
- [ ] 既存データのクレンジング作業を管理部門と協力して進める
- [ ] 同一人物を紐付ける中間テーブルの作成を検討する

### 現在のデータ処理フロー(0A~0F)

- **0A**: アンセムから取得した全データ(否認等を除外した状態)
- **0B(IF卸)**: IF卸とトータルマーケットのタブで「IF卸」として登録されたパートナーのみを抽出
- **0C(トータルマーケット)**: トータルマーケットとして登録されたパートナーを抽出
- **0D(BUBU)**: パートナー名にBUが含まれるもののみ抽出。件数はカウントするが報酬は計上しない(固定扱い)
- **0E(星)**: 成果報酬のパートナー(株式会社ナハト以外)
- **0F(星除く)**: 固定報酬のパートナー(スペクトラム等)
- これらのシートから**アンセムロー**が作成される

### IF卸とトータルマーケットの管理

- **現状の課題**: 新しいメディアがアンセムに追加された際、IF卸/トータルマーケットの登録がないと空白で表示される
- 関口さんが手動でデータを調べてIF卸/トータルマーケットの区分を登録している
- **今後の方向性**: トータルマーケットが完全にIF付きになる可能性があったが、現状は見送りになった。メディアや案件によって異なる対応が続く見込み
- トータルマーケットは期間変更で単価が頻繁に変わるためアンセムへの登録が困難
- **管理部の革命リスト**: ゲッショの件数出しの際、パートナーがIF卸かトータルマーケットかを区分するために使用

### 報酬体系の3パターン

1. **固定**: 単価×件数で売上計上。インフルエンサーへの支出も単価×件数で計算
2. **予算**: クライアントからの売上は予算額で固定。インフルエンサーへの支出は別途設定
    - 予算額を超えた場合の処理は案件によって異なる(超過分を支払う場合/支払わない場合)
    - 予算の場合、件数だけカウントして管理会計上の予算枠を超えないよう調整が必要
3. **成果**: 成果単価はアンセムに登録済み。インフルエンサー単価も設定されており、単価×件数で支出計算

### セミアフィ(半量日)の処理

- 予算額とクライアント単価を基に、関口さんが毎日調査して処理
- アンセムローの件数のところで手計算で実施
- 月別の切り替えが必要だが、エージェント側の登録ミスも発生している

### グロス単価とネット単価の使い分け

- **グロス**: クライアント請求の総額
- **ネット**: メディアへの支払い額
- IF総合ではネット単価を使用
- 卸メディアの場合:
    - グロスでクライアント売上を計算
    - ネット単価でメディアへの支出を計算。約120枚の請求書を1枚1枚目視確認
    - グロスとネットの差額が利益となるため、請求書の単価確認が必須

### 現在の課題

- **単価管理シートが更新されていない**: バラちゃんが作成したTM側の単価管理シートが9月3日以降更新されていない
- **手作業の多さ**: アンセム分解シートでグロス/ネットが正しく出力されないため、全単価を3時間かけて手入力
- **予算入力の遅れ**: AIロボなどの予算が月末まで入力されず、月別とIF総合の乖離が2,300万円に達することも
- **新規メディア対応**: 新しいメディアが追加された際の察知と登録が必要

### アプリ開発による改善計画

- **目的**: スプレッドシートを全廃してアプリに一本化
- **第一段階**: インフルエンサーのデータベースをアプリ化
- **機能要件**:
    - 成果/固定/予算の4項目(区分、単価、件数、売上)を管理
    - セミアフィのステータス切り替え機能
    - クライアント請求単価の自動紐付け
    - 予算金額の管理とクライアント節からの取り込み
- **IF/TM間の調整**: アンセムの余っている列を活用し、IFとTMのルールがかぶらないよう整理中

### 今後の対応方針

- トータルマーケット案件は当面除外する方向性(現在はほぼ全てトータルマーケット扱い)
- IF総合に必要なのは:
    - 株式会社ナハトのパートナー(固定)
    - 個人管理画面の成果パートナー
    - BとC(IF卸/トータルマーケット)は除外可能

### アクションアイテム

- [ ] ロジックを整理して仕様書を作成
- [ ] アプリの機能仕様を箇条書きにまとめて確認
- [ ] 実装する場合はじゅんぺんさんに相談(ただしスモールゴールでは難しい可能性)
- [ ] AI Robo等の予算入力プロセスの改善検討


---

## **🔄 当初要件からの変更点（Change Log）**

### **1. システム名称の変更**

```diff
- 当初: AFAD（アファド）
+ 会議後: ANSEM（アンセム）
```

**影響範囲:**

- 要件定義書の全文書
- データソース名称
- ツール連携の名称

---

### **2. インフルエンサーマスター重複統合の方針変更**

```diff
- 当初: システムで自動統合（マージ機能を実装）
+ 会議後: 手動削除に変更
```

**理由:**

- グループYouTuberの存在（同じYouTubeで個別Instagram）
- 請求先変更（個人→事務所）などビジネスルールが複雑
- システムでの自動判定は困難

**影響範囲:**

- UC-A1「インフルエンサー重複統合」の実装方針
- 重複検知は残すが、統合実行は管理者が手動で行う
- マージ機能の優先度を下げる

---

### **3. MVPスコープの変更（対象案件の絞り込み）**

```diff
- 当初: 全案件を対象
+ 会議後: トータルマーケット案件を当面除外
```

**対象範囲の明確化:**

```
✅ スコープIN:
- 株式会社ナハトのパートナー（固定）
- 個人管理画面の成果パートナー
- IF卸

❌ スコープOUT:
- トータルマーケット（単価が頻繁に変動するため）
- IF卸/トータルマーケット（B/C）は当面除外可能
```

**影響範囲:**

- データ取り込み範囲
- マッピング対象
- 集計対象

---

### **4. データの正（Single Source of Truth）の定義変更**

```diff
- 当初: AFAD正とスプシ集計の乖離を検知
+ 会議後: ANSEM正と「調理」後の各種シート（0A-0F）の乖離を検知
```

**変更理由:**

- 「調理」工程（0A→0B→0C→...→0F）の存在が判明
- 単なる取り込みではなく、複雑な加工処理が挟まっている

**影響範囲:**

- 乖離検知の比較対象が変わる
- 「調理」工程の自動化がスコープに入る

---

### **5. CSV出力要件の変更**

```diff
- 当初: シンプルなCSV出力
+ 会議後: パートナーID重複・コロン区切り問題への対応が必要
```

**具体的な問題:**

- パートナーIDとパートナー名が2カラム存在
- CSV出力時にコロン区切りで番号が付く
- 3桁の数字が重複すると一部データ欠損

**影響範囲:**

- CSV出力フォーマットの仕様を厳密に定義する必要
- 既存の出力形式との互換性考慮

---

### **6. 計測粒度の明確化**

```diff
- 当初: 案件×IF×媒体で集計
+ 会議後: パートナーサイトID単位で計測
          （パートナー名への情報埋め込みを廃止）
```

**変更理由:**

- 現状はパートナー名に情報を埋め込んでいた 例: `[インスタ]田中花子_案件A_BU_担当者名`
- ID管理に移行する方針が確定

**影響範囲:**

- マッピングのキーがパートナーサイトIDベースに
- カスタム項目として情報を別途管理

---

### **7. インフルエンサー単価の扱い**

```diff
- 当初: MVPに含める予定
+ 会議後: スコープ外（後のフェーズで検討）
```

**理由:**

- クライアント請求の方が優先度が高い
- インフルエンサー支払いは後回しでも運用可能

**影響範囲:**

- インフルエンサー向けポータルの機能縮小
- 報酬計算はクライアント側のみに集中

---

## **📊 変更点サマリー（一覧表）**

|#|項目|当初|会議後|影響度|
|---|---|---|---|---|
|1|システム名称|AFAD|ANSEM|低|
|2|IF重複統合|自動マージ|手動削除|高|
|3|MVPスコープ|全案件|TM除外|高|
|4|データの正|AFAD正|ANSEM正+調理工程|中|
|5|CSV出力|シンプル|互換性考慮|中|
|6|計測粒度|案件×IF×媒体|サイトID単位|高|
|7|IF単価|MVPに含む|スコープ外|中|

---

## **🎯 これらの変更が設計に与える影響**

### **最も影響が大きい変更TOP3:**

**1位: インフルエンサー重複統合の方針変更**

```
影響:
- マージ機能の実装優先度が下がる
- 重複検知UIのみ実装
- 統合作業は管理部が手動で実施
```

**2位: MVPスコープの縮小（TM除外）**

```
影響:
- データ取り込み範囲が明確に
- 複雑な単価変動への対応が不要に
- 開発工数の削減
```

**3位: 計測粒度の変更（サイトID単位）**

```
影響:
- マッピングの設計変更
- パートナー名パースロジックの格下げ
- ID管理への移行戦略が必要
```

---

以上、**当初から変わった部分だけ**やで！

これで要件定義書を更新する？それとも次のアクション決める？