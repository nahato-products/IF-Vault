# UX for App Development — Reference

SKILL.md の補足資料。実装ガイド、コンポーネント別パターン、アンチパターン、チェックリスト、参考文献。

---

## フォーム設計

- ラベルはフィールドの上（左配置より完了率が高い）
- プレースホルダーをラベル代わりにしない（入力後に消える）
- 必須マークは`*`よりも任意項目に「任意」と表記する方が良い
- バリデーションはリアルタイム（送信後の一括表示は避ける）→ H5
- エラーメッセージは該当フィールドの直下に赤+アイコンで表示
- 成功状態も視覚フィードバック（緑のチェックマーク）
- 入力タイプを正しく設定（`type="email"`, `type="tel"`, `inputmode="numeric"`）
- オートフィル対応: `autocomplete`属性を正しく設定
- 長いフォームはステップ分割、進捗表示付き → #19
- 入力の寛容性 → #13 ポステルの法則

---

## レスポンシブとモバイル

- タップターゲット: 44x44px以上、間隔8px以上 → #22
- 親指ゾーン: 主要操作は画面下部に配置（片手操作）
- ハンバーガーメニューは最終手段: 主要ナビは常に表示
- 横スクロールは避ける（テーブルは横スクロール可だが下記参照）
- フォントサイズ: 本文16px以上（ピンチズーム不要に）
- タッチフィードバック: タップ時に視覚的反応（`:active`状態）
- ボトムタブバー: 3〜5項目まで。左端と右端に最重要機能 → #6
- ジェスチャー: スワイプで戻る、プルダウンリフレッシュは慣習に従う。独自ジェスチャーは避ける

---

## 色とタイポグラフィ → #15 視覚的階層

### 色の実装ルール

| 用途 | 色 | 備考 |
|---|---|---|
| 成功・完了 | 緑系 | |
| エラー・破壊的操作 | 赤系 | 色だけに頼らずアイコン併用 |
| 警告 | オレンジ/黄系 | |
| 情報・リンク | 青系 | |
| 無効・非活性 | グレー系 | |

- 色数は3色以内（ブランドカラー、アクセント、ニュートラル）
- 文化差: グローバル展開時は装飾色を文化圏ごとに検証

### タイポグラフィ

- フォントファミリーは2種類まで（見出し用＋本文用）
- 行間: 本文は1.5〜1.75、見出しは1.2〜1.3
- 行の長さ: 60〜80文字（日本語は25〜40文字）
- フォントサイズのスケール: 1.25倍比（16, 20, 25, 31...）
- ウェイト: Regular(400), Medium(500), Bold(700) の3段階で十分

---

## データテーブルとリスト

### 基本構造
- セマンティックHTML: `<table>`, `<thead>`, `<th scope="col">`, `<tbody>` を正しく使う
- 固定ヘッダー: スクロール時に列ヘッダーを `position: sticky` で固定
- 固定列: IDや名前列を左固定してコンテキストを維持

### ページネーション vs 仮想スクロール
- 100行以下: ページネーション不要、全件表示
- 100〜1000行: ページネーション（10/25/50/100行の切り替え付き）
- 1000行超: 仮想スクロール（`react-virtual`等）でDOM負荷を軽減
- 無限スクロールはフッター到達不能のリスク。使う場合はスティッキーフッター併用

### ソート・フィルター
- ソートインジケーター（▲▼）を列ヘッダーに表示。`aria-sort`属性を設定
- フィルターは列ヘッダー直下またはツールバーに配置
- アクティブなフィルター条件を常に可視化（チップ表示 + 「クリア」ボタン）

### インライン編集
- セルクリック → 編集モード → フォーカスアウトで保存、ESCでキャンセル
- 編集中セルは視覚的に区別（ボーダー色変更等）
- 保存中/エラー/変更未保存の状態を各セルに表示

### バルクアクション
- ヘッダーチェックボックスで全選択/全解除
- 選択中の件数をツールバーに表示（「3件選択中」）
- 一括操作ボタン（削除、エクスポート等）は選択時のみ表示

### レスポンシブ対応
- モバイルではカード表示に切り替えるか、優先列のみ表示+「詳細」リンク
- 横スクロール使用時は影やフェードで「続きがある」ことを示す

---

## AIチャットUI

### ストリーミング応答
- タイピングインジケーター（「...」アニメ）はAIが応答開始するまで表示
- ストリーミング中は自動スクロール。ユーザーが上にスクロールしたら自動スクロールを停止
- 「停止」ボタンをストリーミング中に表示。押したら生成を中断
- コードブロック・マークダウンはストリーミング中もプログレッシブにレンダリング

### メッセージUI
- ユーザー側とAI側でバブルの色・配置を明確に区別
- AI出力に「AIが生成」ラベル → #28 透明性
- コードブロックにコピーボタン、シンタックスハイライト
- 長い出力は折りたたみ（「もっと見る」）で初期表示量を制御

### 入力UX
- テキストエリアは内容に応じて自動リサイズ（最大高さ制限付き）
- Enter で送信、Shift+Enter で改行（逆も設定可能に）
- 添付ファイル/画像のプレビュー表示
- プロンプトテンプレート/サジェストで初回利用を支援 → #18

### エラーハンドリング
- ネットワーク切断時: メッセージ再送ボタン
- レート制限時: 「しばらく待ってから再試行」+ カウントダウン
- AI生成エラー時: 「再生成」ボタン + 手動入力へのフォールバック → #29

### 会話管理
- 会話の命名（自動+手動編集）、検索、ピン留め、削除
- 新しい会話の開始を常にアクセス可能に

---

## ダッシュボード・データビジュアライゼーション → #1 認知負荷, #25 パレート

### チャートタイプの選択基準
| データの性質 | 推奨チャート |
|---|---|
| 時系列推移 | 折れ線グラフ |
| カテゴリ比較 | 棒グラフ（横棒: カテゴリ名が長い場合） |
| 構成比 | 円/ドーナツグラフ（5カテゴリ以下） |
| 相関関係 | 散布図 |
| 分布 | ヒストグラム |

- 3Dグラフ、過度なグリッド線、装飾は避ける（データインク比を高く保つ）
- チャートの色は色覚多様性を考慮（パターンや形状で補完）

### KPIカード
- 数値は大きなフォントで目立たせる
- 前期比を矢印（↑↓）+ 色（緑/赤）で表示。色だけに頼らない
- スパークライン（小さな推移グラフ）で直近トレンドを示す
- 目標対比がある場合はプログレスバーで表現

### リアルタイム更新
- 自動更新時のちらつき防止: 値の変更箇所だけアニメーション
- 「最終更新: 2分前」の表示 + 手動更新ボタン
- WebSocket接続状態を表示（接続中/切断/再接続中）

### 日付範囲セレクター
- プリセット: 今日/今週/今月/先月/カスタム
- カスタム範囲はカレンダーピッカーで選択
- 比較期間の設定（前年同期比等）

### 空状態
- データ0件のチャートは「まだデータがありません」+ データ取得方法の案内
- 初期状態とエラー状態を視覚的に区別

---

## 通知・トースト設計

### 配置
- デスクトップ: 右上（作業の邪魔をしない位置）
- モバイル: 上部（OSネイティブ通知の慣習）または下部（親指ゾーン）

### 表示時間
- 情報通知: 4秒 / 成功通知: 3秒
- エラー通知: 手動で閉じるまで表示（または10秒）
- アクション付き通知: 手動で閉じるまで表示

### スタック
- 同時表示は3件まで。超える場合は古い通知から消す
- エラー（高優先度）は情報（低優先度）を押し出す

### アクション
- 通知内にCTAボタン配置可能（例: 「元に戻す」「確認」）

### アクセシビリティ
- 情報: `aria-live="polite"` + `role="status"`
- エラー: `aria-live="assertive"` + `role="alert"`
- `prefers-reduced-motion` でアニメーション無効化

---

## 検索UI → H6 再認 > 記憶

### インクリメンタルサーチ
- 入力2〜3文字以上でサジェスト表示（デバウンス300ms）
- 検索語をハイライトで強調
- 矢印キーで候補移動、Enterで選択

### 結果0件
- 「"〇〇"に一致する結果はありません」を明示
- 代替案を提示（スペル確認、フィルター解除の案内）
- 部分一致・類似語の結果を表示

### 最近の検索・サジェスト
- 検索フィールドのフォーカス時に最近の検索5件を表示
- 各項目クリックで再検索

### フィルター連携
- 検索結果をさらにフィルターで絞り込み可能に
- アクティブなフィルターをチップ表示 + 「クリア」ボタン

---

## モーダル設計 → #14 意図的摩擦, H3 主導権

### サイズ
- 小（確認ダイアログ）: 300-400px幅
- 中（フォーム入力）: 500-600px幅
- 大（詳細表示・マルチステップ）: 800px幅
- モバイル: 基本的にフルスクリーン

### 閉じ方
- ESCキー / 右上の×ボタン / 背景クリック
- 破壊的操作のモーダルでは背景クリックを無効化

### ルール
- モーダルの上にモーダルを重ねない → 必要なら別UI（ドロワー等）を使う
- 背景はスクロール不可（`body` に `overflow: hidden`）
- 背景は半透明の黒（`rgba(0,0,0,0.5)`）

### フォーカス管理
- 表示時: 最初のインタラクティブ要素にフォーカス
- Tab: モーダル内だけをループ（フォーカストラップ）
- 閉じた時: 元のフォーカス位置に戻す

### アクセシビリティ
- `role="dialog"` または `role="alertdialog"`
- `aria-labelledby` でタイトル参照
- `aria-modal="true"`

---

## 状態遷移パターン

全てのデータ表示UIは4つの状態を設計する。1つでも欠けると不完全。

| 状態 | 表示内容 | 実装ポイント |
|------|---------|-------------|
| **Loading** | スケルトンUI or スピナー | コンテンツの形状を予測表示。400ms未満はスキップ可 → #9 |
| **Success** | データ表示 | 初期表示後のリフレッシュは差分のみアニメーション |
| **Error** | エラーメッセージ + リトライ | 「再読み込み」ボタン必須。エラー種別で文言変更 → H9 |
| **Empty** | イラスト + CTA | 「まだデータがありません」+次のアクション案内 → #18 |

### 遷移の注意点
- Loading → Success: スケルトンからコンテンツへのフェードイン（100-200ms）
- Loading → Error: スケルトンを即座にエラー表示に切り替え。フェードなし
- Success → Loading（リフレッシュ）: 現在のデータを表示したままオーバーレイスピナー
- Error → Loading（リトライ）: エラー表示をスケルトンに戻す

---

## マイクロコピーガイド → H9 エラー回復

ボタンやメッセージの文言がUXを大きく左右する。

### ボタンラベル
| 悪い例 | 良い例 | 理由 |
|--------|--------|------|
| はい / いいえ | 保存する / 破棄する | 何をするかが明確 |
| 送信 | 注文を確定する | 結果が予測できる |
| OK | 了解 | 攻撃的に見えない |
| キャンセル | 変更を破棄 | 何がキャンセルされるか明確 |

### エラーメッセージ
- **構造**: 何が起きたか + なぜか + どうすればいいか
- 悪: 「エラーが発生しました」
- 良: 「メールアドレスの形式が正しくありません。example@email.com の形式で入力してください」
- 技術用語は使わない（「タイムアウト」→「通信に時間がかかりすぎました」）

### 確認ダイアログ
- タイトル: 「本当に削除しますか？」ではなく「この記事を削除しますか？」（何を削除するか明示）
- 破壊的操作ボタン: 赤色 +「削除する」（動詞で終わる）
- キャンセルボタン: ニュートラル色 +「キャンセル」（左配置）

---

## アンチパターン集

レビュー時に以下を見つけたら即修正。

### ダークパターン（倫理的にNG）
- **ローチモーテル**: 登録は簡単なのに退会が極端に困難
- **こっそりカゴ入れ**: ユーザーが選んでいないものをカートに追加
- **羞恥確認**: 「いいえ、お金を節約したくありません」のような罪悪感を煽る選択肢
- **強制開示**: サービスに不要な個人情報の入力を強制
- **視覚的ミスディレクション**: 解約ボタンをグレーアウトや極小フォントで隠す

### AIアンチパターン
- **ハルシネーション隠蔽**: AIの誤出力を検証なしにそのまま表示 → #28 透明性で対策
- **AI強制**: 手動操作の選択肢がなくAI利用を強制 → #29 制御で対策
- **ブラックボックス**: なぜその結果になったか説明なし → ユーザーの信頼を失う

### 実装アンチパターン
- **ミステリーナビ**: アイコンだけでラベルなし → H6
- **無限スクロールの罠**: フッター情報にたどり着けない → ページネーションかスティッキーフッター
- **モーダル地獄**: モーダルの上にモーダル → 同時に1つまで
- **自動再生**: 音声付き動画の自動再生 → #11
- **ズーム無効化**: `user-scalable=no` → アクセシビリティ違反
- **プレースホルダー依存**: ラベル代わりのプレースホルダー → 入力開始で消えて迷う
- **赤一色のエラー**: 色だけでエラー伝達 → 色覚多様性に対応できない
- **確認ダイアログ乱発**: 全操作に「よろしいですか？」→ 不可逆操作だけに絞る
- **disabled送信ボタン**: なぜ押せないか理由が不明 → バリデーションエラーをインラインで明示
- **水平スクロール**: モバイルで横にはみ出るレイアウト

---

## 実装チェックリスト

### 情報設計
- [ ] 1画面の選択肢は5個以内か
- [ ] 段階的開示を使えるか
- [ ] 視覚的階層は明確か

### フィードバック
- [ ] 応答は400ms以内か（超える場合はスケルトンUI）
- [ ] エラーメッセージは具体的で回復可能か
- [ ] Undo/やり直しが可能か
- [ ] 状態遷移（ローディング→成功/エラー→空状態）は全て設計されているか

### フォーム
- [ ] ラベルはフィールドの上か
- [ ] バリデーションはリアルタイムか
- [ ] 入力の寛容性（全角半角、ハイフン有無）は確保されているか
- [ ] デフォルト値はユーザーに最適か

### モバイル
- [ ] タップターゲットは44x44px以上か
- [ ] 親指ゾーンに主要操作があるか
- [ ] フォントサイズは16px以上か

### アクセシビリティ
- [ ] キーボードだけで全操作できるか
- [ ] スクリーンリーダーで意味が伝わるか
- [ ] `prefers-reduced-motion`に対応しているか
- [ ] エラーは色+アイコン+テキストで伝えているか
- [ ] ニューロダイバーシティ: テキスト左揃え、行間1.5以上、通知最小限か

### AI UX
- [ ] AI出力に「AIが生成」のラベルがあるか
- [ ] AI提案を手動で上書き・却下できるか
- [ ] AI失敗時の手動フォールバックがあるか

### 安全性
- [ ] 破壊的操作に確認ステップがあるか
- [ ] ダークパターンになっていないか

---

## UI Review Output Format

UIコードレビュー時は以下の形式で出力する:

```
### UXレビュー結果

**サマリー**: [1文で全体評価]

#### 問題点
1. **[重要度: CRITICAL/HIGH/MEDIUM]** [問題の説明]
   - 該当原則: #N [原則名] / HN [ヒューリスティック名]
   - 修正案: [具体的な修正内容]

#### 良い点
- [原則に沿っている実装のポジティブフィードバック]

#### チェックリスト結果
- [x] 該当する項目
- [ ] 未対応の項目 → 修正推奨
```

---

## 参考文献

- Miller, G.A. (1956). "The Magical Number Seven, Plus or Minus Two"
- Cowan, N. (2001). "The Magical Number 4 in Short-Term Memory"
- Schwartz, B. (2004). *The Paradox of Choice*
- Nielsen, J. (1994). "10 Usability Heuristics for User Interface Design"
- Norman, D. (2013). *The Design of Everyday Things*
- Krug, S. (2014). *Don't Make Me Think*
- Fitts, P.M. (1954). "The Information Capacity of the Human Motor System"
- Doherty, W.J. & Thadani, A.J. (1982). "The Economic Value of Rapid Response Time"
- Buell, R.W. & Norton, M.I. (2011). "The Labor Illusion"
- W3C (2023). "Web Content Accessibility Guidelines (WCAG) 2.2"
- NN/g (2026). "State of UX 2026: Design Deeper to Differentiate"
- Laws of UX — https://lawsofux.com

---

## プロジェクト固有アンチパターン

実際のアプリ開発で遭遇する、教科書に載っていないUXアンチパターン集。

### 1. 過剰な成功フィードバック症候群

**問題**: 小さなアクション（いいね、保存など）に毎回モーダルやトーストで「成功しました！」と表示。頻繁に操作するユーザーほどストレスが溜まる。

**発見方法**: 同じ操作を5回以上連続で行わせる。3回目以降でフィードバックを閉じる速度が明らかに速くなる。

**対策**: 初回のみ明示的フィードバック、2回目以降は控えめなアニメーション。連続操作時はまとめ通知。楽観的UI更新を活用。

### 2. 設定画面の墓場

**問題**: 使われなくなった設定が削除されず肥大化。ユーザーは重要な設定を判断できずデフォルトのまま使う。

**発見方法**: 各設定項目の変更率を測定。3ヶ月間で変更率1%未満の項目が3つ以上ある。

**対策**: 設定を「基本」「高度」に分離。1年以上変更されない項目は次期バージョンで削除検討。

### 3. チュートリアルの呪い

**問題**: 初回起動時に5画面以上のオンボーディングを強制。ユーザーは読まずにスキップし、後で使い方がわからなくなる。

**発見方法**: オンボーディング完了率が50%未満、サポート問い合わせの70%以上が「チュートリアルで説明済み」。

**対策**: 最大3画面に絞る。機能説明は実際に使う場面でコーチマークとして表示（JIT方式）。

### 4. エラーメッセージのガチャ

**問題**: 同じネットワークエラーでも発生箇所によって異なるメッセージが表示され、ユーザーが「別の問題」と誤認する。

**発見方法**: エラーログを文言で集計し、実質同じエラーが5種類以上の表現で記録されている。

**対策**: エラーメッセージを中央管理。エラーコードで分類し、各メッセージに「次にやるべきこと」を1つだけ明記。

### 5. 検索結果の砂漠

**問題**: 0件ヒット時に「該当なし」とだけ表示。ユーザーは何も行動できず離脱する。

**発見方法**: 0件ヒットの割合が30%以上かつ0件後の離脱率が80%以上。

**対策**: 検索条件を自動緩和した結果を表示。人気カテゴリをレコメンド。スペルミス検出で「もしかして:」を提案。

### 6. ハンバーガーメニュー依存症

**問題**: 重要な機能を全てハンバーガーに隠し、ユーザーが機能の存在に気づかない。

**発見方法**: ハンバーガーメニューのタップ率10%未満。隠された機能の使用率が期待値の50%未満。

**対策**: 上位3機能はタブバーに常時表示。ハンバーガーは補助的な項目のみ。

### 7. 無限スクロールの落とし穴

**問題**: フッター情報（利用規約、問い合わせ先）が無限スクロールの下に隠れ、永遠に到達できない。

**発見方法**: 利用規約ページへの到達率が0.1%未満。

**対策**: フッター情報はサイドバーか固定メニュー内に配置。無限スクロールに明確な終点を設ける。

### 8. 通知許可の早期要求

**問題**: アプリ開始5秒以内に「通知を許可してください」。ユーザーは価値を理解する前にブロックする。

**発見方法**: プッシュ通知許可率20%未満（業界平均40-60%）。

**対策**: 通知が必要になる具体的場面まで待つ。事前にプリパーミッション説明を挟む。拒否されても代替手段を提示。

### 9. フォームの完璧主義

**問題**: ユーザー登録時に10項目以上を要求。途中離脱率80%超。

**発見方法**: ファネル分析で特定フィールド（電話番号、住所など）で急激に離脱が増える。

**対策**: 初回は最小限（メールとパスワード or 外部ログイン）。追加情報は「後で入力」を明示的に許可。

### 10. ダークパターンの後遺症

**問題**: 過去のダークパターン使用でユーザー信頼を失い、改善後もネガティブレビューが残り続ける。

**発見方法**: レビューで「詐欺」「騙された」が月10件以上。解約理由で「信用できなかった」が上位。

**対策**: 過去の問題を公式に謝罪し改善内容を開示。解約ボタンを目立つ位置に配置（逆説的に解約率は下がる）。
