# UX for App Development — Reference

SKILL.md の補足。実装ガイド、パターン、チェックリスト。

---

## フォーム設計

ラベル配置、バリデーション、入力寛容性 → SKILL.md #12-#14

- ラベルはフィールド上配置（左配置より完了率高）
- 必須マークより任意項目に「任意」表記
- エラーは該当フィールド直下に赤+アイコン
- 成功状態も視覚フィードバック（緑チェック）
- 入力タイプ正しく設定（`type="email"`, `inputmode="numeric"`）
- `autocomplete`属性でオートフィル対応
- 長フォームはステップ分割+進捗表示 → #19

---

## レスポンシブとモバイル

- タップターゲット: 44x44px以上、間隔8px以上 → #22
- 親指ゾーン: 主要操作は画面下部
- ハンバーガーメニューは最終手段
- 横スクロール避ける（テーブル除く）
- フォント: 本文16px以上
- タッチフィードバック: `:active`状態
- ボトムタブバー: 3〜5項目、左右端に最重要機能 → #6
- ジェスチャー: 慣習に従う、独自ジェスチャー避ける

---

## 色とタイポグラフィ

視覚的階層 → SKILL.md #15

### 色の実装

| 用途 | 色 | 備考 |
|---|---|---|
| 成功 | 緑系 | |
| エラー・破壊 | 赤系 | アイコン併用 |
| 警告 | オレンジ/黄系 | |
| 情報・リンク | 青系 | |
| 無効 | グレー系 | |

### タイポグラフィ

- フォントファミリー2種まで
- 行間: 本文1.5〜1.75、見出し1.2〜1.3
- 行長: 60〜80文字（日本語25〜40）
- スケール: 1.25倍比（16, 20, 25, 31...）
- ウェイト: Regular(400), Medium(500), Bold(700)

---

## データテーブルとリスト

### 基本
- セマンティックHTML: `<table>`, `<thead>`, `<th scope="col">`, `<tbody>`
- 固定ヘッダー: `position: sticky`
- 固定列: ID/名前列左固定

### ページネーション vs 仮想スクロール
- 100行以下: 全件表示
- 100〜1000行: ページネーション（10/25/50/100行切替）
- 1000行超: 仮想スクロール（`react-virtual`）
- 無限スクロールはフッター到達不能リスク

### ソート・フィルター
- ソートインジケーター（▲▼）+`aria-sort`
- アクティブフィルターをチップ表示+「クリア」

### インライン編集
- セルクリック→編集モード→フォーカスアウトで保存、ESCキャンセル
- 保存中/エラー/変更未保存の状態表示

### バルクアクション
- ヘッダーチェックボックスで全選択
- 選択中件数表示（「3件選択中」）
- 一括操作ボタンは選択時のみ

### レスポンシブ
- モバイルでカード表示切替 or 優先列のみ
- 横スクロール時は影で「続き」を示す

---

## AIチャットUI

### ストリーミング応答
- タイピングインジケーター: AI応答開始まで
- ストリーミング中は自動スクロール（ユーザーが上スクロールで停止）
- 「停止」ボタンで生成中断
- コードブロック・マークダウンをプログレッシブレンダリング

### メッセージUI
- ユーザー/AI側でバブル色・配置区別
- AI出力に「AIが生成」ラベル → #28
- コードブロックにコピーボタン、シンタックスハイライト
- 長出力は折りたたみ

### 入力UX
- テキストエリア自動リサイズ（最大高さ制限）
- Enter送信、Shift+Enter改行（設定可能）
- 添付ファイル/画像プレビュー
- プロンプトテンプレート/サジェスト → #18

### エラーハンドリング
- ネットワーク切断: 再送ボタン
- レート制限: 待機案内+カウントダウン
- AI生成エラー: 「再生成」+手動入力フォールバック → #29

### 会話管理
- 会話の命名（自動+手動）、検索、ピン留め、削除
- 新会話開始を常にアクセス可能に

---

## ダッシュボード・データビジュアライゼーション → #1 認知負荷, #25 パレート

### チャートタイプ選択

| データ性質 | 推奨チャート |
|---|---|
| 時系列推移 | 折れ線グラフ |
| カテゴリ比較 | 棒グラフ（横棒: 長いカテゴリ名） |
| 構成比 | 円/ドーナツ（5カテゴリ以下） |
| 相関 | 散布図 |
| 分布 | ヒストグラム |

- 3D、過度なグリッド線、装飾避ける
- 色覚多様性考慮（パターン/形状で補完）

### KPIカード
- 数値大フォント
- 前期比: 矢印（↑↓）+色（緑/赤）、色だけに頼らない
- スパークラインで直近トレンド
- 目標対比はプログレスバー

### リアルタイム更新
- 値変更箇所だけアニメーション
- 「最終更新: 2分前」+手動更新ボタン
- WebSocket接続状態表示

### 日付範囲セレクター
- プリセット: 今日/今週/今月/先月/カスタム
- カスタム範囲はカレンダーピッカー
- 比較期間設定（前年同期比等）

### 空状態
- 「まだデータがありません」+取得方法案内
- 初期状態とエラー状態を区別

---

## 通知・トースト設計

### 配置
- デスクトップ: 右上
- モバイル: 上部 or 下部（親指ゾーン）

### 表示時間
- 情報: 4秒 / 成功: 3秒
- エラー: 手動で閉じるまで（or 10秒）
- アクション付き: 手動で閉じるまで

### スタック
- 同時表示3件まで
- エラー（高優先）が情報（低優先）を押し出す

### アクセシビリティ
- 情報: `aria-live="polite"` + `role="status"`
- エラー: `aria-live="assertive"` + `role="alert"`
- `prefers-reduced-motion`対応

---

## 検索UI → H6 再認 > 記憶

### インクリメンタルサーチ
- 2〜3文字以上でサジェスト（デバウンス300ms）
- 検索語ハイライト
- 矢印キーで候補移動、Enterで選択

### 結果0件
- 「"〇〇"に一致する結果なし」明示
- 代替案提示（スペル確認、フィルター解除案内）
- 部分一致・類似語表示

### 最近の検索・サジェスト
- フォーカス時に最近の検索5件
- 各項目クリックで再検索

### フィルター連携
- 検索結果をさらにフィルター可能
- アクティブフィルターをチップ表示+「クリア」

---

## モーダル設計 → #14 意図的摩擦, H3 主導権

### サイズ
- 小（確認）: 300-400px / 中（フォーム）: 500-600px / 大（詳細）: 800px
- モバイル: フルスクリーン

### 閉じ方
- ESC / 右上×ボタン / 背景クリック
- 破壊的操作では背景クリック無効化

### ルール
- モーダル重ねない
- 背景スクロール不可（`body` に `overflow: hidden`）
- 背景は半透明黒（`rgba(0,0,0,0.5)`）

### フォーカス管理
- 表示時: 最初のインタラクティブ要素にフォーカス
- Tab: モーダル内だけループ（フォーカストラップ）
- 閉じた時: 元フォーカス位置に戻す

### アクセシビリティ
- `role="dialog"` or `role="alertdialog"`
- `aria-labelledby`でタイトル参照
- `aria-modal="true"`

---

## 状態遷移パターン

全データ表示UIは4状態設計必須。

| 状態 | 表示内容 | 実装ポイント |
|------|---------|-------------|
| **Loading** | スケルトンUI or スピナー | 400ms未満はスキップ可 → #9 |
| **Success** | データ表示 | リフレッシュは差分のみアニメーション |
| **Error** | エラーメッセージ+リトライ | 「再読み込み」ボタン必須 → H9 |
| **Empty** | イラスト+CTA | 次アクション案内 → #18 |

### 遷移
- Loading→Success: フェードイン（100-200ms）
- Loading→Error: 即座切替、フェードなし
- Success→Loading（リフレッシュ）: 現在データ表示のままオーバーレイスピナー
- Error→Loading（リトライ）: エラーをスケルトンに戻す

---

## マイクロコピーガイド → H9 エラー回復

### ボタンラベル

| 悪い例 | 良い例 | 理由 |
|--------|--------|------|
| はい/いいえ | 保存する/破棄する | 何をするか明確 |
| 送信 | 注文を確定する | 結果予測可能 |
| OK | 了解 | 攻撃的に見えない |
| キャンセル | 変更を破棄 | 何がキャンセルされるか明確 |

### エラーメッセージ
- **構造**: 何が起きたか + なぜか + どうすればいいか
- 悪: 「エラーが発生しました」
- 良: 「メールアドレスの形式が正しくありません。example@email.com の形式で入力してください」
- 技術用語使わない（「タイムアウト」→「通信に時間がかかりすぎました」）

### 確認ダイアログ
- タイトル: 「この記事を削除しますか？」（何を削除するか明示）
- 破壊的操作ボタン: 赤色+「削除する」（動詞終わり）
- キャンセル: ニュートラル色+「キャンセル」（左配置）

---

## アンチパターン集

### ダークパターン（倫理的にNG）
- **ローチモーテル**: 登録簡単、退会困難
- **こっそりカゴ入れ**: ユーザー選択外をカート追加
- **羞恥確認**: 罪悪感煽る選択肢
- **強制開示**: 不要な個人情報入力強制
- **視覚的ミスディレクション**: 解約ボタン隠蔽

### AIアンチパターン
- **ハルシネーション隠蔽**: AI誤出力を検証なし表示 → #28
- **AI強制**: 手動操作選択肢なし → #29
- **ブラックボックス**: 説明なし

### 実装アンチパターン
- **ミステリーナビ**: アイコンのみラベルなし → H6
- **無限スクロールの罠**: フッター到達不能
- **モーダル地獄**: モーダル重ね
- **自動再生**: 音声付き動画自動再生 → #11
- **ズーム無効化**: `user-scalable=no`
- **赤一色エラー**: 色だけでエラー伝達
- **水平スクロール**: モバイルではみ出し

---

## 実装チェックリスト

### 情報設計
- [ ] 1画面の選択肢5個以内
- [ ] 段階的開示使用
- [ ] 視覚的階層明確

### フィードバック
- [ ] 応答400ms以内（超える場合スケルトンUI）
- [ ] エラーメッセージ具体的で回復可能
- [ ] Undo/やり直し可能
- [ ] 状態遷移全設計

### フォーム
- [ ] ラベルはフィールド上
- [ ] リアルタイムバリデーション
- [ ] 入力寛容性（全角半角、ハイフン有無）
- [ ] デフォルト値最適

### モバイル
- [ ] タップターゲット44x44px以上
- [ ] 親指ゾーンに主要操作
- [ ] フォント16px以上

### アクセシビリティ
- [ ] キーボードのみで全操作
- [ ] スクリーンリーダー対応
- [ ] `prefers-reduced-motion`対応
- [ ] エラーは色+アイコン+テキスト
- [ ] ニューロダイバーシティ: 左揃え、行間1.5以上、通知最小限

### AI UX
- [ ] AI出力に「AIが生成」ラベル
- [ ] AI提案を手動上書き・却下可能
- [ ] AI失敗時の手動フォールバック

### 安全性
- [ ] 破壊的操作に確認ステップ
- [ ] ダークパターンなし

---

## UI Review Output Format

```
### UXレビュー結果

**サマリー**: [1文で全体評価]

#### 問題点
1. **[重要度: CRITICAL/HIGH/MEDIUM]** [問題説明]
   - 該当原則: #N [原則名] / HN [ヒューリスティック名]
   - 修正案: [具体的修正内容]

#### 良い点
- [原則に沿った実装のポジティブフィードバック]

#### チェックリスト結果
- [x] 該当項目
- [ ] 未対応項目 → 修正推奨
```

---

## 参考文献

- Miller, G.A. "The Magical Number Seven, Plus or Minus Two"
- Cowan, N. "The Magical Number 4 in Short-Term Memory"
- Schwartz, B. *The Paradox of Choice*
- Nielsen, J. "10 Usability Heuristics for User Interface Design"
- Norman, D. *The Design of Everyday Things*
- Krug, S. *Don't Make Me Think*
- Fitts, P.M. "The Information Capacity of the Human Motor System"
- Doherty, W.J. & Thadani, A.J. "The Economic Value of Rapid Response Time"
- Buell, R.W. & Norton, M.I. "The Labor Illusion"
- W3C. "Web Content Accessibility Guidelines (WCAG) 2.2"
- Laws of UX — https://lawsofux.com

---

## 実プロジェクト頻出アンチパターン

| パターン | 症状 | 対策 |
|---------|------|------|
| 過剰成功フィードバック | 小操作に毎回トースト | 初回のみ明示、2回目以降控えめ。楽観的UI更新 |
| 設定画面の墓場 | 使われない設定肥大化 | 「基本」「高度」分離。変更率1%未満削除検討 |
| チュートリアルの呪い | 5画面以上強制オンボーディング | 最大3画面。JIT表示 → #18 |
| エラーメッセージガチャ | 同エラーで異なる文言 | 中央管理。「次にやること」1つ明記 → H9 |
| 検索結果の砂漠 | 0件で「該当なし」のみ | 条件緩和結果表示。「もしかして:」提案 |
| ハンバーガー依存症 | 重要機能全隠し | 上位3機能をタブバー常時表示 → #25 |
| 無限スクロールの罠 | フッター到達不能 | フッターはサイドバーか固定メニュー内 |
| 通知許可早期要求 | 価値理解前にブロック | 必要場面まで遅延。プリパーミッション説明 → #11 |
| フォーム完璧主義 | 登録時10項目以上要求 | 初回最小限。追加情報は「後で入力」許可 → #12 |
| ダークパターン後遺症 | 過去の不正で信頼喪失継続 | 改善開示。解約ボタン目立つ位置 |

---

## クロスリファレンス

### testing-strategy との接続

| UX原則 | テスト観点 | 具体例 |
|--------|-----------|--------|
| #9 ドハティ閾値 | パフォーマンステスト | Playwright で応答400ms以内計測 |
| #14 意図的摩擦 | E2Eフロー | 破壊的操作に確認ダイアログ検証 |
| H5 エラー防止 | バリデーションテスト | 不正入力で送信されない確認 |
| H9 エラー回復 | エラーパステスト | エラーメッセージ表示+リトライ復帰検証 |
| #13 ポステルの法則 | 入力バリエーション | 全角/半角、ハイフン有無網羅テスト |

### systematic-debugging との接続

- **再現手順特殊性**: UXバグは主観的。録画+ヒートマップで再現性確保
- **パターン分析**: 離脱率高→認知負荷(#1) or 選択肢過多(#2)
- **仮説検証**: A/Bテストで1変数ずつ。UX改善効果を定量計測

### error-handling-logging との接続

- `error.tsx`のUI設計 → H9エラー回復適用（修正方法含む）
- ログのエラー分類 → ユーザー向けメッセージとの対応表
- Sentryアラート → ユーザー影響度（認知負荷への影響）で優先度付け

### security-review との接続

- 認証フロー: 安全性保ちつつ認知負荷下げる（パスワードレス認証、Magic Link）
- CSRF対策トークン → ユーザーに見せない（H8美的最小限）
- レート制限 → 残り回数事前表示して #11 リアクタンス防止

### natural-japanese-writing との接続

- エラーメッセージ: 技術用語排除+自然な日本語で「何が起きたか+どうすればいいか」
- ボタンラベル: 動詞終わり（「保存する」「削除する」）。AI臭い「〜してください」避ける
- マイクロコピー: ユーザー感情状態考慮した語調選択

### tailwind-design-system / design-token-system との接続

- 色トークン: 意味的色（success/error/warning）→ 本スキルの色実装ルールと一致
- スペーシングトークン: ゲシュタルト近接原則を数値化（関連要素間隔 < グループ間間隔）
- タイポグラフィトークン: 視覚的階層1.25倍比を `--font-size-*` に反映

### line-bot-dev との接続

- Flex Message: 認知負荷(#1)考慮、1メッセージ3アクション以下
- リッチメニュー: 系列位置効果(#6)で左右端に最重要機能
- クイックリプライ: Hick's Law(#2)で選択肢5個以下

---

## コード例: UX原則の実装パターン

### 楽観的UI更新 (#9 ドハティ閾値)

```tsx
import { useOptimistic } from 'react'; // React 19+

// Server Action + useOptimistic で即座にUIを更新
function TodoList({ todos }: { todos: Todo[] }) {
  const [optimisticTodos, addOptimistic] = useOptimistic(
    todos,
    (state, newTodo: Todo) => [...state, newTodo]
  );

  async function addTodo(formData: FormData) {
    const todo = { id: crypto.randomUUID(), title: formData.get("title") as string };
    addOptimistic(todo); // 即座にUI反映
    await createTodo(todo); // サーバー処理は裏で実行
  }
  // ...
}
```

### 入力の寛容性 (#13 ポステルの法則)

```ts
function normalizePhone(input: string): string {
  return input
    .replace(/[０-９]/g, (c) => String.fromCharCode(c.charCodeAt(0) - 0xFEE0))
    .replace(/[^\d]/g, "");
}

function normalizeEmail(input: string): string {
  return input.trim().toLowerCase();
}
```

### 確認ダイアログ (#14 意図的摩擦)

```tsx
// shadcn/ui Dialog components
// 破壊的操作の確認: 対象名明示 + タイプ入力
function DeleteConfirmDialog({ itemName, onConfirm }: Props) {
  const [typed, setTyped] = useState("");
  const canDelete = typed === itemName;

  return (
    <Dialog>
      <DialogTitle>「{itemName}」を削除しますか？</DialogTitle>
      <p>この操作は取り消せません。確認のため「{itemName}」と入力してください。</p>
      <Input value={typed} onChange={(e) => setTyped(e.target.value)} />
      <DialogActions>
        <Button variant="ghost">キャンセル</Button>
        <Button variant="destructive" disabled={!canDelete}>削除する</Button>
      </DialogActions>
    </Dialog>
  );
}
```
