# UX for App Development — Reference

Supplementary material for SKILL.md. Provides component-specific patterns, numeric criteria, and code examples.

SKILL.md の補足資料。実装ガイド、コンポーネント別パターン、アンチパターン、チェックリスト、クロスリファレンス、参考文献。

---

## フォーム設計

コアルール（ラベル配置、バリデーション、入力の寛容性）は SKILL.md #12-#14 を参照。以下は補足の実装詳細:

- ラベルはフィールドの上配置（左配置より完了率が高い — Matteo Penzo 2006 の調査）
- 必須マークは`*`よりも任意項目に「任意」と表記する方が良い
- エラーメッセージは該当フィールドの直下に赤+アイコンで表示
- 成功状態も視覚フィードバック（緑のチェックマーク）
- 入力タイプを正しく設定（`type="email"`, `type="tel"`, `inputmode="numeric"`）
- オートフィル対応: `autocomplete`属性を正しく設定
- 長いフォームはステップ分割、進捗表示付き → #19

---

## レスポンシブとモバイル

- タップターゲット: 44x44px以上、間隔8px以上 → #22
- 親指ゾーン: 主要操作は画面下部に配置（片手操作）
- ハンバーガーメニューは最終手段: 主要ナビは常に表示
- 横スクロールは避ける（テーブルは横スクロール可だが下記参照）
- フォントサイズ: 本文16px以上（ピンチズーム不要に）
- タッチフィードバック: タップ時に視覚的反応（`:active`状態）
- ボトムタブバー: 3〜5項目まで。左端と右端に最重要機能 → #6
- ジェスチャー: スワイプで戻る、プルダウンリフレッシュは慣習に従う。独自ジェスチャーは避ける

---

## 色とタイポグラフィ

視覚的階層の原則は SKILL.md #15 を参照。以下は具体的な数値基準:

### 色の実装ルール

| 用途 | 色 | 備考 |
|---|---|---|
| 成功・完了 | 緑系 | |
| エラー・破壊的操作 | 赤系 | 色だけに頼らずアイコン併用 |
| 警告 | オレンジ/黄系 | |
| 情報・リンク | 青系 | |
| 無効・非活性 | グレー系 | |

- 文化差: グローバル展開時は装飾色を文化圏ごとに検証

### タイポグラフィ

- フォントファミリーは2種類まで（見出し用＋本文用）
- 行間: 本文は1.5〜1.75、見出しは1.2〜1.3
- 行の長さ: 60〜80文字（日本語は25〜40文字）
- フォントサイズのスケール: 1.25倍比（16, 20, 25, 31...）
- ウェイト: Regular(400), Medium(500), Bold(700) の3段階で十分

---

## データテーブルとリスト

### 基本構造
- セマンティックHTML: `<table>`, `<thead>`, `<th scope="col">`, `<tbody>` を正しく使う
- 固定ヘッダー: スクロール時に列ヘッダーを `position: sticky` で固定
- 固定列: IDや名前列を左固定してコンテキストを維持

### ページネーション vs 仮想スクロール
- 100行以下: ページネーション不要、全件表示
- 100〜1000行: ページネーション（10/25/50/100行の切り替え付き）
- 1000行超: 仮想スクロール（`react-virtual`等）でDOM負荷を軽減
- 無限スクロールはフッター到達不能のリスク。使う場合はスティッキーフッター併用

### ソート・フィルター
- ソートインジケーター（▲▼）を列ヘッダーに表示。`aria-sort`属性を設定
- フィルターは列ヘッダー直下またはツールバーに配置
- アクティブなフィルター条件を常に可視化（チップ表示 + 「クリア」ボタン）

### インライン編集
- セルクリック → 編集モード → フォーカスアウトで保存、ESCでキャンセル
- 編集中セルは視覚的に区別（ボーダー色変更等）
- 保存中/エラー/変更未保存の状態を各セルに表示

### バルクアクション
- ヘッダーチェックボックスで全選択/全解除
- 選択中の件数をツールバーに表示（「3件選択中」）
- 一括操作ボタン（削除、エクスポート等）は選択時のみ表示

### レスポンシブ対応
- モバイルではカード表示に切り替えるか、優先列のみ表示+「詳細」リンク
- 横スクロール使用時は影やフェードで「続きがある」ことを示す

---

## AIチャットUI

### ストリーミング応答
- タイピングインジケーター（「...」アニメ）はAIが応答開始するまで表示
- ストリーミング中は自動スクロール。ユーザーが上にスクロールしたら自動スクロールを停止
- 「停止」ボタンをストリーミング中に表示。押したら生成を中断
- コードブロック・マークダウンはストリーミング中もプログレッシブにレンダリング

### メッセージUI
- ユーザー側とAI側でバブルの色・配置を明確に区別
- AI出力に「AIが生成」ラベル → #28 透明性
- コードブロックにコピーボタン、シンタックスハイライト
- 長い出力は折りたたみ（「もっと見る」）で初期表示量を制御

### 入力UX
- テキストエリアは内容に応じて自動リサイズ（最大高さ制限付き）
- Enter で送信、Shift+Enter で改行（逆も設定可能に）
- 添付ファイル/画像のプレビュー表示
- プロンプトテンプレート/サジェストで初回利用を支援 → #18

### エラーハンドリング
- ネットワーク切断時: メッセージ再送ボタン
- レート制限時: 「しばらく待ってから再試行」+ カウントダウン
- AI生成エラー時: 「再生成」ボタン + 手動入力へのフォールバック → #29

### 会話管理
- 会話の命名（自動+手動編集）、検索、ピン留め、削除
- 新しい会話の開始を常にアクセス可能に

---

## ダッシュボード・データビジュアライゼーション → #1 認知負荷, #25 パレート

### チャートタイプの選択基準
| データの性質 | 推奨チャート |
|---|---|
| 時系列推移 | 折れ線グラフ |
| カテゴリ比較 | 棒グラフ（横棒: カテゴリ名が長い場合） |
| 構成比 | 円/ドーナツグラフ（5カテゴリ以下） |
| 相関関係 | 散布図 |
| 分布 | ヒストグラム |

- 3Dグラフ、過度なグリッド線、装飾は避ける（データインク比を高く保つ）
- チャートの色は色覚多様性を考慮（パターンや形状で補完）

### KPIカード
- 数値は大きなフォントで目立たせる
- 前期比を矢印（↑↓）+ 色（緑/赤）で表示。色だけに頼らない
- スパークライン（小さな推移グラフ）で直近トレンドを示す
- 目標対比がある場合はプログレスバーで表現

### リアルタイム更新
- 自動更新時のちらつき防止: 値の変更箇所だけアニメーション
- 「最終更新: 2分前」の表示 + 手動更新ボタン
- WebSocket接続状態を表示（接続中/切断/再接続中）

### 日付範囲セレクター
- プリセット: 今日/今週/今月/先月/カスタム
- カスタム範囲はカレンダーピッカーで選択
- 比較期間の設定（前年同期比等）

### 空状態
- データ0件のチャートは「まだデータがありません」+ データ取得方法の案内
- 初期状態とエラー状態を視覚的に区別

---

## 通知・トースト設計

### 配置
- デスクトップ: 右上（作業の邪魔をしない位置）
- モバイル: 上部（OSネイティブ通知の慣習）または下部（親指ゾーン）

### 表示時間
- 情報通知: 4秒 / 成功通知: 3秒
- エラー通知: 手動で閉じるまで表示（または10秒）
- アクション付き通知: 手動で閉じるまで表示

### スタック
- 同時表示は3件まで。超える場合は古い通知から消す
- エラー（高優先度）は情報（低優先度）を押し出す

### アクション
- 通知内にCTAボタン配置可能（例: 「元に戻す」「確認」）

### アクセシビリティ
- 情報: `aria-live="polite"` + `role="status"`
- エラー: `aria-live="assertive"` + `role="alert"`
- `prefers-reduced-motion` でアニメーション無効化

---

## 検索UI → H6 再認 > 記憶

### インクリメンタルサーチ
- 入力2〜3文字以上でサジェスト表示（デバウンス300ms）
- 検索語をハイライトで強調
- 矢印キーで候補移動、Enterで選択

### 結果0件
- 「"〇〇"に一致する結果はありません」を明示
- 代替案を提示（スペル確認、フィルター解除の案内）
- 部分一致・類似語の結果を表示

### 最近の検索・サジェスト
- 検索フィールドのフォーカス時に最近の検索5件を表示
- 各項目クリックで再検索

### フィルター連携
- 検索結果をさらにフィルターで絞り込み可能に
- アクティブなフィルターをチップ表示 + 「クリア」ボタン

---

## モーダル設計 → #14 意図的摩擦, H3 主導権

### サイズ
- 小（確認ダイアログ）: 300-400px幅
- 中（フォーム入力）: 500-600px幅
- 大（詳細表示・マルチステップ）: 800px幅
- モバイル: 基本的にフルスクリーン

### 閉じ方
- ESCキー / 右上の×ボタン / 背景クリック
- 破壊的操作のモーダルでは背景クリックを無効化

### ルール
- モーダルの上にモーダルを重ねない → 必要なら別UI（ドロワー等）を使う
- 背景はスクロール不可（`body` に `overflow: hidden`）
- 背景は半透明の黒（`rgba(0,0,0,0.5)`）

### フォーカス管理
- 表示時: 最初のインタラクティブ要素にフォーカス
- Tab: モーダル内だけをループ（フォーカストラップ）
- 閉じた時: 元のフォーカス位置に戻す

### アクセシビリティ
- `role="dialog"` または `role="alertdialog"`
- `aria-labelledby` でタイトル参照
- `aria-modal="true"`

---

## 状態遷移パターン

全てのデータ表示UIは4つの状態を設計する。1つでも欠けると不完全。

| 状態 | 表示内容 | 実装ポイント |
|------|---------|-------------|
| **Loading** | スケルトンUI or スピナー | コンテンツの形状を予測表示。400ms未満はスキップ可 → #9 |
| **Success** | データ表示 | 初期表示後のリフレッシュは差分のみアニメーション |
| **Error** | エラーメッセージ + リトライ | 「再読み込み」ボタン必須。エラー種別で文言変更 → H9 |
| **Empty** | イラスト + CTA | 「まだデータがありません」+次のアクション案内 → #18 |

### 遷移の注意点
- Loading → Success: スケルトンからコンテンツへのフェードイン（100-200ms）
- Loading → Error: スケルトンを即座にエラー表示に切り替え。フェードなし
- Success → Loading（リフレッシュ）: 現在のデータを表示したままオーバーレイスピナー
- Error → Loading（リトライ）: エラー表示をスケルトンに戻す

---

## マイクロコピーガイド → H9 エラー回復

ボタンやメッセージの文言がUXを大きく左右する。

### ボタンラベル
| 悪い例 | 良い例 | 理由 |
|--------|--------|------|
| はい / いいえ | 保存する / 破棄する | 何をするかが明確 |
| 送信 | 注文を確定する | 結果が予測できる |
| OK | 了解 | 攻撃的に見えない |
| キャンセル | 変更を破棄 | 何がキャンセルされるか明確 |

### エラーメッセージ
- **構造**: 何が起きたか + なぜか + どうすればいいか
- 悪: 「エラーが発生しました」
- 良: 「メールアドレスの形式が正しくありません。example@email.com の形式で入力してください」
- 技術用語は使わない（「タイムアウト」→「通信に時間がかかりすぎました」）

### 確認ダイアログ
- タイトル: 「本当に削除しますか？」ではなく「この記事を削除しますか？」（何を削除するか明示）
- 破壊的操作ボタン: 赤色 +「削除する」（動詞で終わる）
- キャンセルボタン: ニュートラル色 +「キャンセル」（左配置）

---

## アンチパターン集

レビュー時に以下を見つけたら即修正。

### ダークパターン（倫理的にNG）
- **ローチモーテル**: 登録は簡単なのに退会が極端に困難
- **こっそりカゴ入れ**: ユーザーが選んでいないものをカートに追加
- **羞恥確認**: 「いいえ、お金を節約したくありません」のような罪悪感を煽る選択肢
- **強制開示**: サービスに不要な個人情報の入力を強制
- **視覚的ミスディレクション**: 解約ボタンをグレーアウトや極小フォントで隠す

### AIアンチパターン
- **ハルシネーション隠蔽**: AIの誤出力を検証なしにそのまま表示 → #28 透明性で対策
- **AI強制**: 手動操作の選択肢がなくAI利用を強制 → #29 制御で対策
- **ブラックボックス**: なぜその結果になったか説明なし → ユーザーの信頼を失う

### 実装アンチパターン
- **ミステリーナビ**: アイコンだけでラベルなし → H6
- **無限スクロールの罠**: フッター情報にたどり着けない → ページネーションかスティッキーフッター
- **モーダル地獄**: モーダルの上にモーダル → 同時に1つまで
- **自動再生**: 音声付き動画の自動再生 → #11
- **ズーム無効化**: `user-scalable=no` → アクセシビリティ違反
- **赤一色のエラー**: 色だけでエラー伝達 → 色覚多様性に対応できない
- **水平スクロール**: モバイルで横にはみ出るレイアウト

---

## 実装チェックリスト

### 情報設計
- [ ] 1画面の選択肢は5個以内か
- [ ] 段階的開示を使えるか
- [ ] 視覚的階層は明確か

### フィードバック
- [ ] 応答は400ms以内か（超える場合はスケルトンUI）
- [ ] エラーメッセージは具体的で回復可能か
- [ ] Undo/やり直しが可能か
- [ ] 状態遷移（ローディング→成功/エラー→空状態）は全て設計されているか

### フォーム
- [ ] ラベルはフィールドの上か
- [ ] バリデーションはリアルタイムか
- [ ] 入力の寛容性（全角半角、ハイフン有無）は確保されているか
- [ ] デフォルト値はユーザーに最適か

### モバイル
- [ ] タップターゲットは44x44px以上か
- [ ] 親指ゾーンに主要操作があるか
- [ ] フォントサイズは16px以上か

### アクセシビリティ
- [ ] キーボードだけで全操作できるか
- [ ] スクリーンリーダーで意味が伝わるか
- [ ] `prefers-reduced-motion`に対応しているか
- [ ] エラーは色+アイコン+テキストで伝えているか
- [ ] ニューロダイバーシティ: テキスト左揃え、行間1.5以上、通知最小限か

### AI UX
- [ ] AI出力に「AIが生成」のラベルがあるか
- [ ] AI提案を手動で上書き・却下できるか
- [ ] AI失敗時の手動フォールバックがあるか

### 安全性
- [ ] 破壊的操作に確認ステップがあるか
- [ ] ダークパターンになっていないか

---

## UI Review Output Format

UIコードレビュー時は以下の形式で出力する:

```
### UXレビュー結果

**サマリー**: [1文で全体評価]

#### 問題点
1. **[重要度: CRITICAL/HIGH/MEDIUM]** [問題の説明]
   - 該当原則: #N [原則名] / HN [ヒューリスティック名]
   - 修正案: [具体的な修正内容]

#### 良い点
- [原則に沿っている実装のポジティブフィードバック]

#### チェックリスト結果
- [x] 該当する項目
- [ ] 未対応の項目 → 修正推奨
```

---

## 参考文献

- Miller, G.A. "The Magical Number Seven, Plus or Minus Two"
- Cowan, N. "The Magical Number 4 in Short-Term Memory"
- Schwartz, B. *The Paradox of Choice*
- Nielsen, J. "10 Usability Heuristics for User Interface Design"
- Norman, D. *The Design of Everyday Things*
- Krug, S. *Don't Make Me Think*
- Fitts, P.M. "The Information Capacity of the Human Motor System"
- Doherty, W.J. & Thadani, A.J. "The Economic Value of Rapid Response Time"
- Buell, R.W. & Norton, M.I. "The Labor Illusion"
- W3C. "Web Content Accessibility Guidelines (WCAG) 2.2"
- Laws of UX — https://lawsofux.com

---

## 実プロジェクトで頻出するアンチパターン

教科書に載らないが実務で繰り返し遭遇するパターン。

| パターン | 症状 | 対策 |
|---------|------|------|
| 過剰な成功フィードバック | 小さな操作に毎回トースト。連続操作でストレス | 初回のみ明示、2回目以降は控えめアニメ。楽観的UI更新 |
| 設定画面の墓場 | 使われない設定が肥大化。重要な設定が埋没 | 「基本」「高度」分離。変更率1%未満の項目は削除検討 |
| チュートリアルの呪い | 5画面以上の強制オンボーディング。読まずにスキップ | 最大3画面。機能説明は使う場面でコーチマーク表示（JIT） → #18 |
| エラーメッセージのガチャ | 同じエラーが箇所によって異なる文言 | エラーメッセージを中央管理。「次にやるべきこと」を1つ明記 → H9 |
| 検索結果の砂漠 | 0件で「該当なし」のみ。行動できず離脱 | 条件緩和した結果表示。「もしかして:」提案 |
| ハンバーガー依存症 | 重要機能を全て隠す。存在に気づかない | 上位3機能はタブバーに常時表示 → #25 |
| 無限スクロールの罠 | フッター情報に永遠に到達不能 | フッターはサイドバーか固定メニュー内に配置 |
| 通知許可の早期要求 | 価値を理解する前にブロックされる | 通知が必要な具体的場面まで遅延。プリパーミッション説明 → #11 |
| フォームの完璧主義 | 登録時に10項目以上要求。離脱率80%超 | 初回は最小限。追加情報は「後で入力」を許可 → #12 |
| ダークパターンの後遺症 | 過去のダークパターンで信頼喪失が残り続ける | 改善を開示。解約ボタンを目立つ位置に配置 |

---

## クロスリファレンスガイド

このスキルの原則を他スキルと組み合わせて適用するケース。非自明な接続に注目。

### testing-strategy との接続

UX原則はテスト設計の判断基準になる。

| UX原則 | テスト観点 | 具体例 |
|--------|-----------|--------|
| #9 ドハティ閾値 | パフォーマンステスト | Playwright で `page.waitForSelector` の応答が400ms以内か計測 |
| #14 意図的摩擦 | E2Eフロー | 破壊的操作に確認ダイアログが出ることを検証 |
| H5 エラー防止 | バリデーションテスト | 不正入力でフォームが送信されないことを確認 |
| H9 エラー回復 | エラーパステスト | エラーメッセージが表示され、リトライで復帰できることを検証 |
| #13 ポステルの法則 | 入力バリエーション | 全角/半角、ハイフン有無のパターンを網羅テスト |

### systematic-debugging との接続

UX問題のデバッグは通常のバグと異なるアプローチが必要。

- **再現手順の特殊性**: UXバグは「ユーザーが混乱する」という主観的事象。録画 + ヒートマップデータで再現性を確保
- **パターン分析**: 離脱率が高いページ → 認知負荷 (#1) か選択肢過多 (#2) を疑う
- **仮説検証**: A/Bテストで1変数ずつ変更。UX改善の効果を定量計測

### error-handling-logging との接続

エラーハンドリングの技術実装に心理学的設計を注入する。

- `error.tsx` のUI設計 → H9 エラー回復の原則を適用（修正方法を含める）
- ログのエラー分類 → ユーザー向けメッセージとの対応表を作る
- Sentryアラート → ユーザー影響度（認知負荷への影響）で優先度付け

### security-review との接続

セキュリティ要件とUXの摩擦バランス。

- 認証フロー: 安全性を保ちつつ認知負荷を下げる（パスワードレス認証、Magic Link）
- CSRF対策のトークン → ユーザーに見せない（H8 美的で最小限）
- レート制限 → ユーザーに残り回数を事前表示して #11 リアクタンスを防ぐ

### natural-japanese-writing との接続

UXライティングの日本語品質。

- エラーメッセージ: 技術用語排除 + 自然な日本語で「何が起きたか + どうすればいいか」
- ボタンラベル: 動詞で終わる（「保存する」「削除する」）。AI臭い「〜してください」を避ける
- マイクロコピー: ユーザーの感情状態を考慮した語調選択

### tailwind-design-system / design-token-system との接続

デザイントークンがUX原則を体現する。

- 色トークン: 意味的色（success/error/warning）→ 本スキルの色の実装ルールと一致させる
- スペーシングトークン: ゲシュタルト近接の原則を数値化（関連要素の間隔 < グループ間の間隔）
- タイポグラフィトークン: 視覚的階層の1.25倍比を `--font-size-*` に反映

### line-bot-dev との接続

LINE Bot / LIFF のUX設計。

- Flex Message: 認知負荷 (#1) を考慮して情報量を制限（1メッセージ3アクション以下）
- リッチメニュー: 系列位置効果 (#6) で左端・右端に最重要機能を配置
- クイックリプライ: Hick's Law (#2) で選択肢を5個以下に

---

## コード例: UX原則の実装パターン

### 楽観的UI更新 (#9 ドハティ閾値)

```tsx
// Server Action + useOptimistic で即座にUIを更新
function TodoList({ todos }: { todos: Todo[] }) {
  const [optimisticTodos, addOptimistic] = useOptimistic(
    todos,
    (state, newTodo: Todo) => [...state, newTodo]
  );

  async function addTodo(formData: FormData) {
    const todo = { id: crypto.randomUUID(), title: formData.get("title") as string };
    addOptimistic(todo); // 即座にUI反映
    await createTodo(todo); // サーバー処理は裏で実行
  }
  // ...
}
```

### 入力の寛容性 (#13 ポステルの法則)

```ts
// ユーザー入力を内部で正規化
function normalizePhone(input: string): string {
  return input
    .replace(/[０-９]/g, (c) => String.fromCharCode(c.charCodeAt(0) - 0xFEE0))
    .replace(/[^\d]/g, "");
}

function normalizeEmail(input: string): string {
  return input.trim().toLowerCase();
}
```

### 確認ダイアログ (#14 意図的摩擦)

```tsx
// 破壊的操作の確認: 対象名を明示 + タイプ入力
function DeleteConfirmDialog({ itemName, onConfirm }: Props) {
  const [typed, setTyped] = useState("");
  const canDelete = typed === itemName;

  return (
    <Dialog>
      <DialogTitle>「{itemName}」を削除しますか？</DialogTitle>
      <p>この操作は取り消せません。確認のため「{itemName}」と入力してください。</p>
      <Input value={typed} onChange={(e) => setTyped(e.target.value)} />
      <DialogActions>
        <Button variant="ghost">キャンセル</Button>
        <Button variant="destructive" disabled={!canDelete}>削除する</Button>
      </DialogActions>
    </Dialog>
  );
}
```
