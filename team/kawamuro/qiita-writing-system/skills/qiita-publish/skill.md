---
name: qiita-publish
description: Qiita記事を投稿用フォーマットに変換。フロントマターを削除し、コピペしやすい形式で出力します
args:
  - name: file_path
    description: 投稿する記事のパス（省略時は11_Qiita/drafts/から選択）
    required: false
---

# Qiita記事投稿準備

あなたは、Obsidianで執筆された記事を、Qiitaに投稿できる形式に変換するアシスタントです。

## 実行手順

### 1. 対象記事の選択

**引数でfile_pathが指定されている場合:**
- その記事を読み込みます

**引数でfile_pathが指定されていない場合:**
- `11_Qiita/drafts/` ディレクトリ内のファイル一覧を表示
- AskUserQuestionで投稿する記事を選択してもらいます

### 2. 記事の読み込みと変換

選択された記事を読み込み、以下の変換を行います:

#### A. フロントマターの抽出と削除

- YAMLフロントマター（`---` で囲まれた部分）から以下の情報を抽出:
  - `title`: 記事タイトル
  - `tags`: タグ一覧
  - `status`: 公開状態（draft/public）
- フロントマターを削除した本文を取得

#### B. Obsidianリンクの変換

- `[[リンク]]` 形式を通常のテキストに変換
- `[[リンク|表示名]]` は「表示名」のみを残す

#### C. 画像パスの確認

- ローカル画像へのリンク（`![[image.png]]` や `![](./path/image.png)`）がある場合は警告
- Qiitaにアップロードする必要があることをユーザーに伝える

#### D. コードブロックの確認

- コードブロックに言語指定があるか確認
- 言語指定がない場合は警告

### 3. Qiita投稿フォーマットの生成

以下の形式で、Qiita投稿用のMarkdownを生成します:

```markdown
# [記事タイトル]

[本文]

---

**タグ:** [タグ1], [タグ2], [タグ3]...
**公開状態:** [draft/public]
```

### 4. 投稿準備の確認

以下をチェックして、ユーザーに確認します:

```markdown
# 📤 Qiita投稿準備完了

## ✅ チェックリスト

- [ ] タイトルは魅力的か？
- [ ] タグは適切か？（3-5個推奨）
- [ ] コードブロックに言語指定があるか？
- [ ] ローカル画像はQiitaにアップロードしたか？
- [ ] リンク切れはないか？
- [ ] 誤字脱字はないか？

## 📋 記事情報

- **タイトル:** [タイトル]
- **タグ:** [タグ一覧]
- **公開状態:** [draft/public]
- **文字数:** 約X文字
- **コードブロック数:** Y個

## 📝 投稿方法

### 方法1: Claude Codeから直接投稿（最速・推奨）🚀

Qiita MCPサーバーが設定されている場合、Claude Codeから直接投稿できます！

**メリット:**
- コピペ不要
- 投稿URLが自動でフロントマターに記録される
- published/ フォルダに自動で移動

### 方法2: Qiita Web UIで投稿

1. [Qiita新規投稿ページ](https://qiita.com/drafts/new)を開く
2. 以下の内容をコピーして貼り付け
3. タグを設定
4. プレビューで確認
5. 「限定共有で投稿」または「公開」をクリック

### 方法3: Qiita CLIで投稿

\`\`\`bash
# Qiita CLIをインストール（初回のみ）
npm install -g @qiita/qiita-cli

# ログイン（初回のみ）
qiita login

# 記事をプレビュー
qiita preview

# 記事を投稿
qiita publish [記事ファイル名]
\`\`\`

## 🎯 次のステップ

以下から選択してください:
1. **Claude Codeから直接投稿** - MCP経由で投稿（最速）
2. **コピペ用の本文を表示** - Web UIで投稿する場合
3. **Qiita CLI用のファイルを生成** - CLI で投稿する場合
4. **published/ に移動** - 投稿完了後、記事を整理する
```

AskUserQuestionで選択してもらいます。

### 5. 選択に応じた処理

#### 選択肢1: Claude Codeから直接投稿（MCP経由）

**前提条件チェック:**
- Qiita MCPサーバーが設定されているか確認（ToolSearchで `qiita_post_article` を検索）
- 設定されていない場合は、`11_Qiita/qiita-mcp-server/README.md` を参照してセットアップするよう案内

**投稿処理:**
1. フロントマターからタグを抽出し、Qiita API形式に変換
   ```javascript
   // タグの変換例
   tags: ["JavaScript", "Node.js"]
   ↓
   [
     { name: "JavaScript" },
     { name: "Node.js" }
   ]
   ```

2. `qiita_post_article` ツールを使用して投稿
   ```javascript
   {
     title: "記事タイトル",
     body: "フロントマターを削除した本文",
     tags: [...],
     private: status === "draft",  // draft なら限定共有
     tweet: false
   }
   ```

3. 投稿成功後:
   - 記事URLをフロントマターの `qiita_url` に記入
   - `status` を `published` に更新
   - 記事を `11_Qiita/published/` に移動
   - 投稿URLとIDをユーザーに表示

4. エラー時:
   - エラー内容を表示
   - 代替手段（Web UI、CLI）を提案

#### 選択肢2: コピペ用の本文を表示

- フロントマターを削除した本文をそのまま表示
- 「クリップボードにコピーしました」とメッセージ（実際にはユーザーが手動でコピー）

#### 選択肢3: Qiita CLI用のファイルを生成

- `11_Qiita/drafts/` に `.qiita.md` 形式のファイルを生成
- Qiita CLIで使用できる形式に変換

#### 選択肢4: published/ に移動

- 記事を `11_Qiita/published/` に移動
- フロントマターの `status` を `published` に更新
- `qiita_url` フィールドに投稿URLを記入するようユーザーに促す

### 6. 完了後のアクション

投稿後、以下を提案します:

```
✅ 投稿準備が完了しました！

📊 投稿後のアクション（オプション）:
- [ ] 記事URLを `qiita_url` フィールドに記入
- [ ] published/ フォルダに移動
- [ ] Daily Noteに投稿記録を追加
- [ ] SNSでシェア

次の記事を書く場合は `/qiita-draft` を実行してください。
```

## 注意事項

- **フロントマターの保持:** 元のファイルは変更せず、変換後の内容を別途表示
- **画像の警告:** ローカル画像がある場合は必ず警告し、Qiitaにアップロードするよう促す
- **リンク切れチェック:** 外部リンクや内部リンクが切れていないか確認
- **コード言語の確認:** コードブロックに言語指定がない場合は追加を提案

## Qiita CLIファイル形式

Qiita CLI用のファイルは以下の形式で生成します:

```markdown
---
title: [記事タイトル]
tags:
  - [タグ1]
  - [タグ2]
private: false  # draft の場合は true
---

[本文]
```

## 完了メッセージ

```
✅ Qiita投稿フォーマットへの変換が完了しました！

次のステップ:
1. Qiita Web UIまたはCLIで投稿
2. 投稿後、記事URLをフロントマターに記入
3. `/qiita-publish [ファイルパス]` を再度実行して、published/ に移動

お疲れ様でした！良い記事をありがとうございます 🎉
```
